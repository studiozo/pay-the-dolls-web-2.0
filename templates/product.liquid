{% comment %}
  PAY THE DØLLS™ — Product Page Template (v2.0)
  Template: product.paythedolls.liquid
  
  FIXES:
  - Product images fit within container (no cropping)
  - object-contain instead of object-cover
  - Maintains aspect ratio
  - Clean minimal layout matching brand aesthetic
{% endcomment %}

{% layout 'theme' %}

<style>
  /* Product image container - fits image without cropping */
  .ptd-product-image-container {
    position: relative;
    width: 100%;
    background: #fafafa;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 400px;
  }
  
  @media (min-width: 768px) {
    .ptd-product-image-container {
      min-height: 500px;
      max-height: 80vh;
    }
  }
  
  .ptd-product-image-container img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
  }
  
  /* Thumbnail gallery */
  .ptd-thumbnail {
    border: 2px solid transparent;
    transition: all 0.2s ease;
    cursor: pointer;
    background: #fafafa;
  }
  
  .ptd-thumbnail:hover,
  .ptd-thumbnail.active {
    border-color: black;
  }
  
  .ptd-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  
  /* Variant buttons */
  .ptd-variant-btn {
    border: 1px solid #e5e5e5;
    transition: all 0.2s ease;
  }
  
  .ptd-variant-btn:hover {
    border-color: #999;
  }
  
  .ptd-variant-btn.selected {
    border-color: black;
    background: black;
    color: white;
  }
  
  .ptd-variant-btn.unavailable {
    opacity: 0.4;
    text-decoration: line-through;
  }
  
  /* Quantity input */
  .ptd-qty-input {
    -moz-appearance: textfield;
  }
  
  .ptd-qty-input::-webkit-outer-spin-button,
  .ptd-qty-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  
  /* Add to cart button */
  .ptd-add-to-cart {
    transition: all 0.3s ease;
  }
  
  .ptd-add-to-cart:hover:not(:disabled) {
    background: #333;
  }
  
  .ptd-add-to-cart:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  
  /* Sticky image on desktop */
  @media (min-width: 1024px) {
    .ptd-sticky-image {
      position: sticky;
      top: 100px;
    }
  }
</style>

<div class="bg-white min-h-screen text-black font-sans selection:bg-black selection:text-white">
  
  <!-- Breadcrumb -->
  <div class="border-b border-gray-100">
    <div class="max-w-[1400px] mx-auto px-4 md:px-8 py-4">
      <nav class="text-xs font-mono uppercase tracking-widest text-gray-400">
        <a href="/" class="hover:text-black transition-colors">Home</a>
        <span class="mx-2">/</span>
        <a href="/pages/paythedolls" class="hover:text-black transition-colors">Shop</a>
        <span class="mx-2">/</span>
        <span class="text-black">{{ product.title }}</span>
      </nav>
    </div>
  </div>

  <div class="max-w-[1400px] mx-auto px-4 md:px-8 py-8 md:py-16">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16">
      
      <!-- LEFT: Product Images -->
      <div class="ptd-sticky-image">
        
        <!-- Main Image Container -->
        <div class="ptd-product-image-container border border-gray-100 mb-4" id="main-image-container">
          <img 
            id="main-product-image"
            src="{{ product.featured_image | img_url: '1200x' }}" 
            alt="{{ product.title }}"
            class="p-4"
          />
        </div>
        
        <!-- Thumbnail Gallery -->
        {% if product.images.size > 1 %}
          <div class="grid grid-cols-5 gap-2">
            {% for image in product.images %}
              <button 
                class="ptd-thumbnail aspect-square p-2 {% if forloop.first %}active{% endif %}"
                data-image-url="{{ image | img_url: '1200x' }}"
                data-image-alt="{{ image.alt | default: product.title }}"
                onclick="changeMainImage(this)"
              >
                <img 
                  src="{{ image | img_url: '200x' }}" 
                  alt="{{ image.alt | default: product.title }}"
                  loading="lazy"
                />
              </button>
            {% endfor %}
          </div>
        {% endif %}
        
      </div>
      
      <!-- RIGHT: Product Info -->
      <div>
        
        <!-- Title -->
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold uppercase tracking-tight leading-tight mb-4">
          {{ product.title }}
        </h1>
        
        <!-- Vendor Badge -->
        <div class="mb-6">
          <span class="inline-block border border-black px-4 py-2 text-xs font-bold uppercase tracking-widest">
            Created by {{ product.vendor }}
          </span>
        </div>
        
        <!-- Price -->
        <div class="mb-8">
          <span id="product-price" class="text-3xl md:text-4xl font-bold">
            {{ product.selected_or_first_available_variant.price | money }}
          </span>
          {% if product.compare_at_price_max > product.price %}
            <span class="text-lg text-gray-400 line-through ml-3">
              {{ product.compare_at_price_max | money }}
            </span>
          {% endif %}
        </div>
        
        <!-- Product Form -->
        <form id="product-form" action="/cart/add" method="post" enctype="multipart/form-data">
          
          <!-- Variant Options -->
          {% unless product.has_only_default_variant %}
            {% for option in product.options_with_values %}
              <div class="mb-6">
                <label class="block text-xs font-bold uppercase tracking-widest mb-3">
                  {{ option.name }}
                </label>
                <div class="flex flex-wrap gap-2">
                  {% for value in option.values %}
                    <button 
                      type="button"
                      class="ptd-variant-btn px-4 py-3 text-sm font-bold uppercase tracking-wider min-w-[60px] {% if option.selected_value == value %}selected{% endif %}"
                      data-option-index="{{ forloop.parentloop.index0 }}"
                      data-value="{{ value }}"
                      onclick="selectOption(this)"
                    >
                      {{ value }}
                    </button>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}
          {% endunless %}
          
          <!-- Hidden variant select (for form submission) -->
          <select name="id" id="variant-select" class="hidden">
            {% for variant in product.variants %}
              <option 
                value="{{ variant.id }}" 
                {% if variant == product.selected_or_first_available_variant %}selected{% endif %}
                data-available="{{ variant.available }}"
                data-price="{{ variant.price | money }}"
                data-image="{{ variant.image | img_url: '1200x' }}"
                {% for option in variant.options %}
                  data-option{{ forloop.index }}="{{ option }}"
                {% endfor %}
              >
                {{ variant.title }}
              </option>
            {% endfor %}
          </select>
          
          <!-- Quantity & Add to Cart -->
          <div class="flex gap-4 mb-8">
            
            <!-- Quantity -->
            <div class="flex border border-black">
              <button 
                type="button" 
                class="px-4 py-3 text-lg font-bold hover:bg-gray-100 transition-colors"
                onclick="adjustQuantity(-1)"
              >−</button>
              <input 
                type="number" 
                name="quantity" 
                id="quantity-input"
                value="1" 
                min="1" 
                class="ptd-qty-input w-16 text-center text-lg font-bold border-l border-r border-black"
              />
              <button 
                type="button" 
                class="px-4 py-3 text-lg font-bold hover:bg-gray-100 transition-colors"
                onclick="adjustQuantity(1)"
              >+</button>
            </div>
            
            <!-- Add to Cart -->
            <button 
              type="submit" 
              id="add-to-cart-btn"
              class="ptd-add-to-cart flex-1 bg-black text-white font-bold uppercase tracking-widest text-sm py-4 px-8"
              {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}
            >
              {% if product.selected_or_first_available_variant.available %}
                Add to Cart
              {% else %}
                Sold Out
              {% endif %}
            </button>
            
          </div>
          
        </form>
        
        <!-- Description -->
        {% if product.description != blank %}
          <div class="border-t border-gray-200 pt-8 mb-8">
            <div class="prose prose-sm max-w-none text-gray-600 leading-relaxed">
              {{ product.description }}
            </div>
          </div>
        {% endif %}
        
        <!-- Product Meta -->
        <div class="border-t border-gray-200 pt-8 space-y-3 text-xs font-mono uppercase tracking-widest text-gray-400">
          {% if product.type != blank %}
            <p>Type: <span class="text-black">{{ product.type }}</span></p>
          {% endif %}
          {% if product.vendor != blank %}
            <p>Vendor: <span class="text-black">{{ product.vendor }}</span></p>
          {% endif %}
          <p>SKU: <span class="text-black" id="product-sku">{{ product.selected_or_first_available_variant.sku | default: 'N/A' }}</span></p>
        </div>
        
        <!-- Tags -->
        {% if product.tags.size > 0 %}
          <div class="border-t border-gray-200 pt-8 mt-8">
            <div class="flex flex-wrap gap-2">
              {% for tag in product.tags %}
                <span class="text-[10px] font-mono uppercase tracking-widest text-gray-400 border border-gray-200 px-3 py-1">
                  {{ tag }}
                </span>
              {% endfor %}
            </div>
          </div>
        {% endif %}
        
      </div>
      
    </div>
  </div>
  
</div>

<script>
  // Store variant data
  const variants = [
    {% for variant in product.variants %}
      {
        id: {{ variant.id }},
        available: {{ variant.available }},
        price: {{ variant.price | money | json }},
        sku: {{ variant.sku | json }},
        image: {{ variant.image | img_url: '1200x' | json }},
        options: [
          {% for option in variant.options %}
            {{ option | json }}{% unless forloop.last %},{% endunless %}
          {% endfor %}
        ]
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
  
  // Current selected options
  let selectedOptions = [
    {% for option in product.options_with_values %}
      {{ option.selected_value | json }}{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
  
  // Change main product image
  function changeMainImage(thumbnailEl) {
    const mainImage = document.getElementById('main-product-image');
    const imageUrl = thumbnailEl.dataset.imageUrl;
    const imageAlt = thumbnailEl.dataset.imageAlt;
    
    mainImage.src = imageUrl;
    mainImage.alt = imageAlt;
    
    // Update active state
    document.querySelectorAll('.ptd-thumbnail').forEach(t => t.classList.remove('active'));
    thumbnailEl.classList.add('active');
  }
  
  // Select variant option
  function selectOption(buttonEl) {
    const optionIndex = parseInt(buttonEl.dataset.optionIndex);
    const value = buttonEl.dataset.value;
    
    // Update selected options
    selectedOptions[optionIndex] = value;
    
    // Update button states for this option group
    buttonEl.parentElement.querySelectorAll('.ptd-variant-btn').forEach(btn => {
      btn.classList.remove('selected');
    });
    buttonEl.classList.add('selected');
    
    // Find matching variant
    const matchingVariant = variants.find(v => {
      return v.options.every((opt, idx) => opt === selectedOptions[idx]);
    });
    
    if (matchingVariant) {
      updateVariant(matchingVariant);
    }
  }
  
  // Update page with new variant
  function updateVariant(variant) {
    // Update hidden select
    document.getElementById('variant-select').value = variant.id;
    
    // Update price
    document.getElementById('product-price').textContent = variant.price;
    
    // Update SKU
    document.getElementById('product-sku').textContent = variant.sku || 'N/A';
    
    // Update image if variant has one
    if (variant.image) {
      document.getElementById('main-product-image').src = variant.image;
    }
    
    // Update add to cart button
    const addToCartBtn = document.getElementById('add-to-cart-btn');
    if (variant.available) {
      addToCartBtn.disabled = false;
      addToCartBtn.textContent = 'Add to Cart';
    } else {
      addToCartBtn.disabled = true;
      addToCartBtn.textContent = 'Sold Out';
    }
    
    // Update URL without reload
    const url = new URL(window.location.href);
    url.searchParams.set('variant', variant.id);
    window.history.replaceState({}, '', url);
  }
  
  // Adjust quantity
  function adjustQuantity(delta) {
    const input = document.getElementById('quantity-input');
    const newValue = Math.max(1, parseInt(input.value) + delta);
    input.value = newValue;
  }
  
  // Initialize: check URL for variant param
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const variantId = urlParams.get('variant');
    
    if (variantId) {
      const variant = variants.find(v => v.id === parseInt(variantId));
      if (variant) {
        // Update selected options based on variant
        selectedOptions = [...variant.options];
        
        // Update button states
        document.querySelectorAll('.ptd-variant-btn').forEach(btn => {
          const optionIndex = parseInt(btn.dataset.optionIndex);
          const value = btn.dataset.value;
          
          if (selectedOptions[optionIndex] === value) {
            btn.classList.add('selected');
          } else {
            btn.classList.remove('selected');
          }
        });
        
        updateVariant(variant);
      }
    }
  });
</script>