{% comment %}
  PAY THE DØLLS™ — Shop Page
  Template: paythedolls.liquid
  Function: Tabbed single-page catalog filtered by tags
  
  CATEGORIES (by tag, case-insensitive):
  - Apparel
  - Accessories  
  - Artifacts
  - Art
  - Aura
  
  SETUP: Create as page template, assign to your PTD shop page
{% endcomment %}

{% layout 'theme' %}

<style>
  /* PTD Tab System */
  .ptd-scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .ptd-scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<div class="bg-white min-h-screen text-black font-sans selection:bg-black selection:text-white">
  <div class="max-w-[1400px] mx-auto py-24 px-6 md:px-12">
    
    <!-- Header -->
    <header class="mb-16 text-center max-w-4xl mx-auto">
      <h1 class="text-4xl md:text-7xl font-bold uppercase tracking-tight mb-6">PAY THE DØLLS™ — Shop</h1>
      <h2 class="text-xl md:text-2xl font-medium uppercase tracking-widest mb-8 border-b border-black pb-4 inline-block">The house brand. Secure the bag.</h2>
      
      <div class="w-16 h-px bg-black mx-auto mb-12"></div>
      <p class="text-[#666] text-lg font-light leading-relaxed max-w-2xl mx-auto italic text-center">
        "All profit fuels Verse Capital. Create without Permission. Profit without Limit."
      </p>
    </header>

    <!-- Tab Navigation -->
    <div class="mb-12 flex flex-wrap justify-center gap-4 border-b border-gray-200 pb-6 ptd-scrollbar-hide overflow-x-auto">
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 bg-black text-white" data-tab="apparel">
        Apparel
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="accessories">
        Accessories
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="artifacts">
        Artifacts
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="art">
        Art
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="aura">
        Aura
      </button>
    </div>

    <!-- Section Header (Dynamic) -->
    <div class="flex items-end justify-between border-b border-black mb-12 pb-4">
      <h3 id="ptd-section-title" class="text-5xl font-bold uppercase tracking-tighter">Apparel</h3>
      <a id="ptd-view-all-link" href="/collections/paythedolls-apparel" class="text-xs font-mono uppercase tracking-widest underline decoration-1 underline-offset-4 hover:bg-black hover:text-white px-2 py-1 transition-colors">View All</a>
    </div>

    <!-- Product Grid -->
    <div id="ptd-product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-px gap-y-px bg-gray-200 border border-gray-200">
      <!-- Products injected by JS -->
    </div>

  </div>
</div>

<script>
  // PRODUCT DATA — Pulled from collections.all, categorized by tags
  const PTD_PRODUCTS = [
    {%- assign first_item = true -%}
    {%- for product in collections.all.products -%}
      {%- comment -%} Determine category from tags (case-insensitive) {%- endcomment -%}
      {%- assign product_category = '' -%}
      {%- for tag in product.tags -%}
        {%- assign tag_lower = tag | downcase -%}
        {%- if tag_lower == 'apparel' or tag_lower == 'clothing' -%}
          {%- assign product_category = 'apparel' -%}
        {%- elsif tag_lower == 'accessories' or tag_lower == 'accessory' -%}
          {%- assign product_category = 'accessories' -%}
        {%- elsif tag_lower == 'artifacts' or tag_lower == 'artifact' -%}
          {%- assign product_category = 'artifacts' -%}
        {%- elsif tag_lower == 'art' -%}
          {%- assign product_category = 'art' -%}
        {%- elsif tag_lower == 'aura' -%}
          {%- assign product_category = 'aura' -%}
        {%- endif -%}
      {%- endfor -%}
      
      {%- comment -%} Only include products that have a PTD category {%- endcomment -%}
      {%- if product_category != '' -%}
        {%- unless first_item -%},{%- endunless -%}
        {%- assign first_item = false -%}
        {
          id: {{ product.id }},
          title: {{ product.title | json }},
          price: {{ product.price | money | json }},
          img: {{ product.featured_image | img_url: '800x' | json }},
          url: {{ product.url | json }},
          category: '{{ product_category }}'
        }
      {%- endif -%}
    {%- endfor -%}
  ];

  // Category metadata
  const PTD_CATEGORIES = {
    apparel: { title: 'Apparel', collection: '/collections/paythedolls-apparel' },
    accessories: { title: 'Accessories', collection: '/collections/paythedolls-accessories' },
    artifacts: { title: 'Artifacts', collection: '/collections/paythedolls-artifacts' },
    art: { title: 'Art', collection: '/collections/paythedolls-art' },
    aura: { title: 'Aura', collection: '/collections/paythedolls-aura' }
  };

  document.addEventListener('DOMContentLoaded', () => {
    const gridEl = document.getElementById('ptd-product-grid');
    const sectionTitle = document.getElementById('ptd-section-title');
    const viewAllLink = document.getElementById('ptd-view-all-link');
    const tabBtns = document.querySelectorAll('.ptd-tab-btn');
    
    let activeTab = 'apparel'; // Default tab

    const renderGrid = (category) => {
      const items = PTD_PRODUCTS.filter(item => item.category === category);
      const categoryMeta = PTD_CATEGORIES[category];
      
      // Update section header
      sectionTitle.textContent = categoryMeta.title;
      viewAllLink.href = categoryMeta.collection;
      
      if (items.length === 0) {
        gridEl.innerHTML = `
          <div class="col-span-full py-12 text-center bg-gray-50 text-gray-500 font-mono text-sm uppercase tracking-widest">
            No products found in ${categoryMeta.title}.
          </div>`;
        return;
      }

      gridEl.innerHTML = items.map(item => `
        <a href="${item.url}" class="group bg-white relative aspect-[3/4] overflow-hidden block hover:z-10">
          <div class="absolute inset-0">
            <img 
              src="${item.img}" 
              alt="${item.title}"
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
              loading="lazy"
            />
          </div>
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 flex flex-col justify-end p-6 transition-colors duration-300">
            <div class="bg-white text-black p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out">
              <h4 class="font-bold uppercase tracking-tight text-lg">${item.title}</h4>
              <div class="flex justify-between items-center mt-2 border-t border-gray-100 pt-2">
                <span class="font-mono text-sm">${item.price}</span>
                <span class="text-[10px] uppercase tracking-widest bg-black text-white px-2 py-1">View</span>
              </div>
            </div>
          </div>
        </a>
      `).join('');
    };

    // Initial render
    renderGrid(activeTab);

    // Tab click handling
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const newTab = btn.getAttribute('data-tab');
        if (newTab === activeTab) return;
        
        activeTab = newTab;
        
        // Update tab styling
        tabBtns.forEach(b => {
          if (b.getAttribute('data-tab') === activeTab) {
            b.classList.add('bg-black', 'text-white');
            b.classList.remove('hover:bg-black', 'hover:text-white');
          } else {
            b.classList.remove('bg-black', 'text-white');
            b.classList.add('hover:bg-black', 'hover:text-white');
          }
        });

        renderGrid(activeTab);
        
        // Smooth scroll to grid (optional)
        gridEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });
  });
</script>