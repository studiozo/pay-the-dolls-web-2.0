{% comment %}
  PAY THE DØLLS™ — Shop Page (FIXED)
  Template: paythedolls.liquid
  Function: Tabbed single-page catalog filtered by tags AND product type
  
  FIX: Now checks BOTH product.tags AND product.type for category matching
  This catches products categorized via Shopify's product type system
  
  CATEGORIES:
  - Apparel (tags: apparel, clothing, tops, bottoms, tøps, bøttoms | types: apparel, t-shirts, shirts)
  - Accessories (tags: accessories, accessory | types: accessories)
  - Artifacts (tags: artifacts, artifact | types: artifacts)
  - Art (tags: art | types: art, prints, artwork)
  - Aura (tags: aura | types: aura, fragrance, candles)
{% endcomment %}

{% layout 'theme' %}

<style>
  .ptd-scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .ptd-scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<div class="bg-white min-h-screen text-black font-sans selection:bg-black selection:text-white">
  <div class="max-w-[1400px] mx-auto py-24 px-6 md:px-12">
    
    <!-- Header -->
    <header class="mb-16 text-center max-w-4xl mx-auto">
      <h1 class="text-4xl md:text-7xl font-bold uppercase tracking-tight mb-6">PAY THE DØLLS™ — Shop</h1>
      <h2 class="text-xl md:text-2xl font-medium uppercase tracking-widest mb-8 border-b border-black pb-4 inline-block">The house brand. Secure the bag.</h2>
      
      <div class="w-16 h-px bg-black mx-auto mb-12"></div>
      <p class="text-[#666] text-lg font-light leading-relaxed max-w-2xl mx-auto italic text-center">
        "All profit fuels Verse Capital. Create without Permission. Profit without Limit."
      </p>
    </header>

    <!-- Tab Navigation -->
    <div class="mb-12 flex flex-wrap justify-center gap-4 border-b border-gray-200 pb-6 ptd-scrollbar-hide overflow-x-auto">
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 bg-black text-white" data-tab="apparel">
        Apparel
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="accessories">
        Accessories
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="artifacts">
        Artifacts
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="art">
        Art
      </button>
      <button class="ptd-tab-btn px-6 py-3 border border-black uppercase font-bold tracking-widest text-xs transition-all duration-300 hover:bg-black hover:text-white" data-tab="aura">
        Aura
      </button>
    </div>

    <!-- Section Header (Dynamic) -->
    <div class="flex items-end justify-between border-b border-black mb-12 pb-4">
      <h3 id="ptd-section-title" class="text-5xl font-bold uppercase tracking-tighter">Apparel</h3>
      <a id="ptd-view-all-link" href="/collections/apparel" class="text-xs font-mono uppercase tracking-widest underline decoration-1 underline-offset-4 hover:bg-black hover:text-white px-2 py-1 transition-colors">View All</a>
    </div>

    <!-- Product Grid -->
    <div id="ptd-product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-px gap-y-px bg-gray-200 border border-gray-200">
      <!-- Products injected by JS -->
    </div>

  </div>
</div>

<script>
  // PRODUCT DATA — Now checks BOTH tags AND product type
  const PTD_PRODUCTS = [
    {%- assign first_item = true -%}
    {%- for product in collections.all.products -%}
      
      {%- comment -%} Get product type lowercase for matching {%- endcomment -%}
      {%- assign type_lower = product.type | downcase -%}
      
      {%- comment -%} Build a combined string of all tags (lowercase) for easier matching {%- endcomment -%}
      {%- assign all_tags_lower = '' -%}
      {%- for tag in product.tags -%}
        {%- assign tag_lower = tag | downcase -%}
        {%- assign all_tags_lower = all_tags_lower | append: tag_lower | append: '|' -%}
      {%- endfor -%}
      
      {%- comment -%} Determine category by checking tags AND product type {%- endcomment -%}
      {%- assign product_category = '' -%}
      
      {%- comment -%} APPAREL CHECK {%- endcomment -%}
      {%- if all_tags_lower contains 'apparel' 
          or all_tags_lower contains 'clothing' 
          or all_tags_lower contains 'tops' 
          or all_tags_lower contains 'tøps'
          or all_tags_lower contains 'bottoms'
          or all_tags_lower contains 'bøttoms'
          or all_tags_lower contains 'shirt'
          or all_tags_lower contains 'tank'
          or all_tags_lower contains 'hoodie'
          or type_lower contains 'apparel'
          or type_lower contains 't-shirt'
          or type_lower contains 'shirt'
          or type_lower contains 'clothing'
          or type_lower contains 'tank'
          or type_lower contains 'hoodie' -%}
        {%- assign product_category = 'apparel' -%}
      {%- endif -%}
      
      {%- comment -%} ACCESSORIES CHECK {%- endcomment -%}
      {%- if all_tags_lower contains 'accessories' 
          or all_tags_lower contains 'accessory'
          or all_tags_lower contains 'bag'
          or all_tags_lower contains 'hat'
          or type_lower contains 'accessor' -%}
        {%- assign product_category = 'accessories' -%}
      {%- endif -%}
      
      {%- comment -%} ARTIFACTS CHECK {%- endcomment -%}
      {%- if all_tags_lower contains 'artifacts' 
          or all_tags_lower contains 'artifact'
          or type_lower contains 'artifact' -%}
        {%- assign product_category = 'artifacts' -%}
      {%- endif -%}
      
      {%- comment -%} ART CHECK {%- endcomment -%}
      {%- if all_tags_lower contains 'art'
          or all_tags_lower contains 'print'
          or all_tags_lower contains 'prints'
          or all_tags_lower contains 'artwork'
          or type_lower contains 'art'
          or type_lower contains 'print' -%}
        {%- assign product_category = 'art' -%}
      {%- endif -%}
      
      {%- comment -%} AURA CHECK {%- endcomment -%}
      {%- if all_tags_lower contains 'aura'
          or all_tags_lower contains 'fragrance'
          or all_tags_lower contains 'candle'
          or type_lower contains 'aura'
          or type_lower contains 'fragrance'
          or type_lower contains 'candle' -%}
        {%- assign product_category = 'aura' -%}
      {%- endif -%}
      
      {%- comment -%} Only include products that matched a category {%- endcomment -%}
      {%- if product_category != '' -%}
        {%- unless first_item -%},{%- endunless -%}
        {%- assign first_item = false -%}
        {
          id: {{ product.id }},
          title: {{ product.title | json }},
          price: {{ product.price | money | json }},
          img: {{ product.featured_image | img_url: '800x' | json }},
          url: {{ product.url | json }},
          category: '{{ product_category }}',
          tags: {{ product.tags | json }},
          type: {{ product.type | json }}
        }
      {%- endif -%}
    {%- endfor -%}
  ];

  // Category metadata — updated collection handles
  const PTD_CATEGORIES = {
    apparel: { title: 'Apparel', collection: '/collections/apparel' },
    accessories: { title: 'Accessories', collection: '/collections/accessories' },
    artifacts: { title: 'Artifacts', collection: '/collections/artifacts' },
    art: { title: 'Art', collection: '/collections/art' },
    aura: { title: 'Aura', collection: '/collections/aura' }
  };

  document.addEventListener('DOMContentLoaded', () => {
    const gridEl = document.getElementById('ptd-product-grid');
    const sectionTitle = document.getElementById('ptd-section-title');
    const viewAllLink = document.getElementById('ptd-view-all-link');
    const tabBtns = document.querySelectorAll('.ptd-tab-btn');
    
    let activeTab = 'apparel';

    // DEBUG: Log what products were found
    console.log('PTD Products loaded:', PTD_PRODUCTS.length);
    console.log('Products by category:', {
      apparel: PTD_PRODUCTS.filter(p => p.category === 'apparel').length,
      accessories: PTD_PRODUCTS.filter(p => p.category === 'accessories').length,
      artifacts: PTD_PRODUCTS.filter(p => p.category === 'artifacts').length,
      art: PTD_PRODUCTS.filter(p => p.category === 'art').length,
      aura: PTD_PRODUCTS.filter(p => p.category === 'aura').length
    });
    console.log('All products:', PTD_PRODUCTS);

    const renderGrid = (category) => {
      const items = PTD_PRODUCTS.filter(item => item.category === category);
      const categoryMeta = PTD_CATEGORIES[category];
      
      // Update section header
      sectionTitle.textContent = categoryMeta.title;
      viewAllLink.href = categoryMeta.collection;
      
      if (items.length === 0) {
        gridEl.innerHTML = `
          <div class="col-span-full py-12 text-center bg-gray-50 text-gray-500 font-mono text-sm uppercase tracking-widest">
            No products found in ${categoryMeta.title}.
          </div>`;
        return;
      }

      gridEl.innerHTML = items.map(item => `
        <a href="${item.url}" class="group bg-white relative aspect-[3/4] overflow-hidden block hover:z-10">
          <div class="absolute inset-0">
            <img 
              src="${item.img}" 
              alt="${item.title}"
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
              loading="lazy"
            />
          </div>
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 flex flex-col justify-end p-6 transition-colors duration-300">
            <div class="bg-white text-black p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out">
              <h4 class="font-bold uppercase tracking-tight text-lg">${item.title}</h4>
              <div class="flex justify-between items-center mt-2 border-t border-gray-100 pt-2">
                <span class="font-mono text-sm">${item.price}</span>
                <span class="text-[10px] uppercase tracking-widest bg-black text-white px-2 py-1">View</span>
              </div>
            </div>
          </div>
        </a>
      `).join('');
    };

    // Initial render
    renderGrid(activeTab);

    // Tab click handling
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const newTab = btn.getAttribute('data-tab');
        if (newTab === activeTab) return;
        
        activeTab = newTab;
        
        tabBtns.forEach(b => {
          if (b.getAttribute('data-tab') === activeTab) {
            b.classList.add('bg-black', 'text-white');
            b.classList.remove('hover:bg-black', 'hover:text-white');
          } else {
            b.classList.remove('bg-black', 'text-white');
            b.classList.add('hover:bg-black', 'hover:text-white');
          }
        });

        renderGrid(activeTab);
        gridEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });
  });
</script>